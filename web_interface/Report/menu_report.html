<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menú de Reportes - S&M</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/sidebar.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header" style="padding: 0.75rem 1rem; min-height: auto;">
            <div class="header-content" style="padding: 0;">
                <div class="logo-section" style="align-items: center; gap: 1rem;">
                    <div class="logo-circle" style="width: 50px; height: 50px; font-size: 0.85rem;">
                        <span class="logo-text" style="font-size: 0.9rem; font-weight: bold;">S&M</span>
                        <div class="logo-subtitle" style="font-size: 0.6rem; margin-top: 2px;">REPORTES</div>
                    </div>
                    <div class="title-section">
                        <h1 class="main-title" style="font-size: 1.25rem; margin: 0; line-height: 1.2;">Menú de Reportes</h1>
                        <p class="subtitle" style="font-size: 0.9rem; margin: 0;">Análisis y Estadísticas Empresariales</p>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <div class="menu-container">
                <div class="menu-frame">
                    <h2 class="menu-title">Menú de Reportes</h2>
                    
                    <div class="menu-grid">
                        <!-- Fila 1 -->
                        <div class="menu-item" onclick="abrirReporteVentas()">
                            <div class="menu-button">
                                <div class="button-icon">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div class="button-text">REPORTE DE<br>VENTAS</div>
                            </div>
                        </div>

                        <div class="menu-item" onclick="abrirHistorialVentas()">
                            <div class="menu-button">
                                <div class="button-icon">
                                    <i class="fas fa-receipt"></i>
                                </div>
                                <div class="button-text">NOTAS DE<br>VENTA</div>
                            </div>
                        </div>

                        <div class="menu-item" onclick="abrirReporteInventario()">
                            <div class="menu-button">
                                <div class="button-icon">
                                    <i class="fas fa-boxes"></i>
                                </div>
                                <div class="button-text">INVENTARIO</div>
                            </div>
                        </div>

                        <!-- Fila 2 - Botón Volver -->
                        <div class="menu-item menu-item-single" onclick="volverAlMenuPrincipal()">
                            <div class="menu-button exit-button">
                                <div class="button-icon">
                                    <i class="fas fa-arrow-left"></i>
                                </div>
                                <div class="button-text">VOLVER</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="app-footer">
            <p>© 2025 Sistema de Gestión Empresarial | Módulo de Reportes</p>
        </footer>
    </div>

    <!-- Scripts -->
    <script>
        // Funciones de navegación de reportes
        
        function abrirReporteVentas() {
            console.log('[REPORTES] Abriendo Reporte de Ventas...');
            
            // Mostrar indicador de carga
            mostrarCargando('Cargando reporte de ventas...');
            
            // Navegar a la página de reporte de ventas
            setTimeout(() => {
                try {
                    // Intentar usar PyWebView API si está disponible
                    if (window.pywebview && window.pywebview.api && window.pywebview.api.open_sales_report) {
                        window.pywebview.api.open_sales_report();
                    } else {
                        // Navegación HTML directa
                        window.location.href = 'report_sales.html';
                    }
                } catch (error) {
                    console.error('[REPORTES] Error abriendo reporte:', error);
                    // Fallback a navegación directa
                    window.location.href = 'report_sales.html';
                } finally {
                    ocultarCargando();
                }
            }, 500);
        }
        
        function abrirHistorialVentas() {
            console.log('[REPORTES] Abriendo Historial de Ventas...');
            
            // Mostrar indicador de carga
            mostrarCargando('Cargando historial de ventas...');
            
            // Comunicar con Python si está disponible
            if (window.pywebview && window.pywebview.api && window.pywebview.api.reports_historial) {
                window.pywebview.api.reports_historial().then(result => {
                    console.log('[REPORTES] Resultado historial ventas:', result);
                    ocultarCargando();
                    // Manejar resultado si es necesario
                }).catch(error => {
                    console.error('[REPORTES] Error en historial ventas:', error);
                    ocultarCargando();
                    mostrarMensajeDemo('Historial de Ventas');
                });
            } else {
                // Modo demostración
                setTimeout(() => {
                    ocultarCargando();
                    mostrarMensajeDemo('Historial de Ventas');
                }, 1000);
            }
        }
        
        function abrirReporteInventario() {
            console.log('[REPORTES] Abriendo Reporte de Inventario...');
            
            // Mostrar mensaje de desarrollo
            mostrarMensaje(
                'Reporte de Inventario',
                'Módulo de reporte de inventario en desarrollo',
                'info'
            );
        }
        
        function volverAlMenuPrincipal() {
            console.log('[REPORTES] Volviendo al menú principal...');
            
            // Intentar navegar de vuelta al índice
            try {
                if (window.pywebview && window.pywebview.api && window.pywebview.api.volver_menu_principal) {
                    window.pywebview.api.volver_menu_principal();
                } else {
                    // Navegación directa
                    window.location.href = '../index.html';
                }
            } catch (error) {
                console.error('[REPORTES] Error volviendo al menú:', error);
                // Fallback
                window.location.href = '../index.html';
            }
        }
        
        // Funciones auxiliares
        function mostrarCargando(mensaje = 'Cargando...') {
            // Crear overlay de carga
            const overlay = document.createElement('div');
            overlay.id = 'loading-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 9999;
                color: white;
                font-size: 1.2rem;
            `;
            
            overlay.innerHTML = `
                <div style="text-align: center; padding: 2rem; background: rgba(0, 0, 0, 0.8); border-radius: 10px;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 1rem;"></i>
                    <div>${mensaje}</div>
                </div>
            `;
            
            document.body.appendChild(overlay);
        }
        
        function ocultarCargando() {
            const overlay = document.getElementById('loading-overlay');
            if (overlay) {
                overlay.remove();
            }
        }
        
        function mostrarMensajeDemo(tipoReporte) {
            mostrarMensaje(
                `${tipoReporte} - Modo Demostración`,
                `El módulo de ${tipoReporte} está funcionando en modo demostración.\n\nPara ver datos reales, asegúrese de que la base de datos esté conectada y contenga información de ventas.`,
                'info'
            );
        }
        
        function mostrarMensaje(titulo, mensaje, tipo = 'info') {
            // Crear modal de mensaje
            const modal = document.createElement('div');
            modal.id = 'message-modal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
            `;
            
            const iconos = {
                'info': 'fas fa-info-circle',
                'success': 'fas fa-check-circle',
                'warning': 'fas fa-exclamation-triangle',
                'error': 'fas fa-times-circle'
            };
            
            const colores = {
                'info': '#3498db',
                'success': '#27ae60',
                'warning': '#f39c12',
                'error': '#e74c3c'
            };
            
            modal.innerHTML = `
                <div style="background: white; padding: 2rem; border-radius: 10px; max-width: 500px; text-align: center; box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
                    <div style="color: ${colores[tipo]}; font-size: 3rem; margin-bottom: 1rem;">
                        <i class="${iconos[tipo]}"></i>
                    </div>
                    <h2 style="color: var(--text-color); margin-bottom: 1rem;">${titulo}</h2>
                    <p style="color: var(--text-color); margin-bottom: 2rem; white-space: pre-line;">${mensaje}</p>
                    <button onclick="cerrarMensaje()" style="background: ${colores[tipo]}; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 5px; cursor: pointer; font-size: 1rem;">
                        <i class="fas fa-check"></i> Entendido
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function cerrarMensaje() {
            const modal = document.getElementById('message-modal');
            if (modal) {
                modal.remove();
            }
        }

    </script>
    <script src="../js/sidebar-new.js"></script>

</body>
</html>
